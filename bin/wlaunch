#!/bin/sh
#
# Smart application launcher, behaves as follows:
# 	application not active -> launch application
# 	application is active and has focus -> launch new application window
# 	application is active and does not have focus -> give application focus
#
# Depends on wmctrl and xdotool. To determine app_wm_class argument check output 
# from "wmctrl -lx"
#
# Based off https://github.com/urukrama/dotfiles_loka/blob/master/scripts/only_thunar
#

default_exec="thunar"
default_wm_class="thunar"

app_exec=${1:-$default_exec}
app_wm_class=${2:-$default_wm_class}
 
# If application is not started then start one
if [ -z "`wmctrl -lx | awk '{print $3}' | grep $app_wm_class`" ]; then
	$app_exec &
else
	current_desk=`wmctrl -d | grep '*' | cut -d ' ' -f 1`
	app_on_this_desk=`wmctrl -lx | awk '{print $1," ",$2," ",$3}' | grep "$current_desk[ ]*$app_wm_class" | cut -d ' ' -f 1 | head -n 1`
	
	if [ -n "$app_on_this_desk" ]; then
		# Application is running on current desktop
		
		app_with_focus=`printf "0x%x" $(xdotool getwindowfocus)`
		app_to_focus=$app_on_this_desk
		if [[ $app_to_focus -eq $app_with_focus ]]; then
			# Application is running and currently has focus, launch new window
			$app_exec &
		else
			# If application is running on active desktop then give raise and give focus
			wmctrl -i -a $app_on_this_desk
		fi;
		
	else
		# If application is running on inactive desktop then move it to this desktop, give raise and give focus
		wmctrl -x -R $app_wm_class
	fi;
fi;

